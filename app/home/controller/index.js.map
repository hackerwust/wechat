{
    "version": 3,
    "sources": [
        "../../../src/home/controller/index.js"
    ],
    "names": [],
    "mappings": "AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;;;;;;;;;;;mBAGE,I,mBAAc;AAAA;;AAAA,sCAAN,IAAM;AAAN,UAAM;AAAA;;AACZ,4CAAM,IAAN,iDAAc,IAAd;AACA,SAAK,IAAL,GAAY,KAAK,KAAL,CAAW,MAAX,CAAZ;AACA,SAAK,QAAL,GAAgB,KAAK,KAAL,CAAW,UAAX,CAAhB;AACD,G;;mBAEK,W;;UACA,G;;;;;AAAA,iB,GAAM,SAAS,KAAK,MAAL,CAAY,KAAZ,CAAT,EAA6B,EAA7B,KAAoC,C;;mBAC1C,G;;;;;+CACK,KAAK,QAAL,CAAc,mBAAd,C;;;+CAEF,KAAK,OAAL,E;;;;;;;;;;;;;;;;;mBAGH,a;2FAAc,I;UACd,I,EACA,I,EACA,I,EAEA,G,EAIA,I,EACA,S;;;;;AATA,kB,GAAO,KAAK,I;AACZ,kB,GAAO,KAAK,IAAL,CAAU,MAAV,C;AACP,kB,GAAO,KAAK,IAAL,CAAU,MAAV,C;;qBAEK,KAAK,SAAL,CAAe,MAAf,C;;;AAAZ,iB;;kBACC,G;;;;;gDACI,KAAK,IAAL,CAAU,EAAC,QAAQ,QAAT,EAAmB,QAAQ,SAA3B,EAAV,C;;;AAEL,kB,GAAO,EAAC,KAAK,GAAN,EAAW,UAAX,EAAiB,UAAjB,EAAuB,OAAO,+BAA9B,E;;qBACW,KAAK,IAAL,CAAU,GAAV,CAAc,IAAd,C;;;AAAlB,uB;;AACJ,kBAAI,aAAa,GAAjB,EAAsB;AACpB,qBAAK,IAAL,CAAU,EAAC,QAAQ,SAAT,EAAoB,QAApB,EAAV;AACD,eAFD,MAEO;AACL,qBAAK,IAAL,CAAU,EAAC,QAAQ,QAAT,EAAmB,QAAQ,QAA3B,EAAV;AACD;;;;;;;;;;;;;;;;;mBAGG,a;2FAAc,I;UACd,I,EACA,E,EACA,I,EAIA,K;;;;;AANA,kB,GAAO,KAAK,I;AACZ,gB,GAAK,SAAS,KAAK,IAAL,CAAU,IAAV,CAAT,EAA0B,EAA1B,KAAiC,C;AACtC,kB,GAAO,KAAK,IAAL,CAAU,MAAV,C;;oBACP,CAAC,EAAD,IAAO,CAAC,I;;;;;gDACH,KAAK,IAAL,CAAU,EAAC,QAAQ,QAAT,EAAmB,QAAQ,WAA3B,EAAV,C;;;;qBAES,KAAK,IAAL,CAAU,KAAV,CAAgB,EAAC,KAAK,EAAN,EAAU,UAAV,EAAhB,EAAiC,IAAjC,E;;;AAAd,mB;;oBACA,MAAM,OAAN,CAAc,KAAd,KAAwB,MAAM,GAAN,IAAa,E;;;;;gDAChC,KAAK,IAAL,CAAU,EAAC,QAAQ,QAAT,EAAmB,QAAQ,QAA3B,EAAV,C;;;AAET,mBAAK,MAAL,CAAY,KAAZ,EAAmB,MAAM,GAAzB;gDACO,KAAK,IAAL,CAAU,EAAC,QAAQ,SAAT,EAAoB,MAAM,KAA1B,EAAV,C;;;;;;;;;;;;;;;;;mBAGH,S;2FAAU,Q;UAAU,G,yDAAM,C;UAE1B,I;;;;;;qBADE,KAAK,QAAL,CAAc,KAAd,CAAoB,EAAC,KAAK,QAAN,EAApB,EAAqC,SAArC,CAA+C,SAA/C,EAA0D,GAA1D,C;;;;qBACW,KAAK,QAAL,CAAc,KAAd,CAAoB,EAAC,KAAK,QAAN,EAApB,EAAqC,IAArC,E;;;AAAb,kB;gDACG,KAAK,OAAL,GAAe,KAAK,OAApB,GAA8B,I",
    "file": "../../../src/home/controller/index.js",
    "sourcesContent": [
        "'use strict';\n\nimport Base from './base.js';\n\nexport default class extends Base {\n  init(...args) {\n    super.init(...args);\n    this.user = this.model(\"user\");\n    this.auto_inc = this.model(\"auto_inc\");\n  }\n\n  async indexAction() {\n    var uid = parseInt(this.cookie(\"uid\"), 10) || 0;\n    if (uid) {\n      return this.redirect(\"/chat/index/index\");\n    }\n    return this.display();\n  }\n  \n  async adduserAction(self) {\n    var http = self.http;\n    var name = http.post(\"name\");\n    var pass = http.post(\"pass\");\n\n    var uid = await self.getAutoId(\"user\");\n    if (!uid) {\n      return http.json({status: \"failed\", reason: \"uid创建失败\"});\n    }\n    var data = {_id: uid, name, pass, photo: \"/static/tmp/photo/default.jpg\"};\n    var insert_id = await self.user.add(data);\n    if (insert_id == uid) {\n      http.json({status: \"success\", uid});\n    } else {\n      http.json({status: \"failed\", reason: \"用户创建失败\"});\n    }\n  }\n  \n  async dologinAction(self) {\n    var http = self.http;\n    var id = parseInt(http.post(\"id\"), 10) || 0;\n    var pass = http.post(\"pass\");\n    if (!id || !pass) {\n      return http.json({status: 'failed', reason: \"用户名或者密码为空\"});\n    }\n    var uinfo = await self.user.where({_id: id, pass}).find();\n    if (think.isEmpty(uinfo) || uinfo._id != id) {\n      return http.json({status: 'failed', reason: \"未匹配到用户\"});\n    }\n    this.cookie(\"uid\", uinfo._id);\n    return http.json({status: \"success\", info: uinfo});\n  }\n\n  async getAutoId(col_name, num = 1) {\n    await this.auto_inc.where({_id: col_name}).increment(\"push_id\", num);\n    var auto = await this.auto_inc.where({_id: col_name}).find();\n    return auto.push_id ? auto.push_id : null;\n  }\n  \n}"
    ]
}